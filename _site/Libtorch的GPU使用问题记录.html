<!DOCTYPE html>
<html>
<head>
    <meta name="baidu-site-verification" content="code-Dl8A5pKE0q" />
    <meta name="sogou_site_verification" content="mkPjRPFSuX"/>
    <meta name="google-site-verification" content="b7k6aby5ZtozLlZ30hshswmengGoITlYyhgbLNtBMVI" />
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Libtorch的GPU使用问题记录</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- reward.js -->
    <link rel="stylesheet" type="text/css" href="/assets/built/reward.css" /> 
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="欢迎各位看官光临本小站，希望共同学习进步哈！" />
    <link rel="shortcut icon" href="http://localhost:4000/assets/images/yy.jpg" type="image/png" />
    <link rel="canonical" href="http://localhost:4000/Libtorch%E7%9A%84GPU%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="李小肥的YY" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Libtorch的GPU使用问题记录" />
    <meta property="og:description" content="这里得吹逼下自己领导，10min解决了困扰我2天的问题（好吧，也许是我太蠢）。 一. 问题描述 由于项目需要使用libtorch（pytorch的C++版本）的GPU版本，但是发现无法使用GPU，因此将问题和解决过程记录下来，方便日后观看和反思。 二. 解决问题的过程 2.1 使用的torch版本 这里需要说下pytorch和libtorch的版本一定要一致，且和cuda的版本一致。这里都是通过pytorch官网上进行安装即可。 pytorch1.6.0（GPU）：使用pip安装 # CUDA 10.1 pip install torch==1.6.0+cu101 torchvision==0.7.0+cu101 -f https://download.pytorch.org/whl/torch_stable.html pytorch1.6.0（CPU）：使用pip安装 # CPU only pip install torch==1.6.0+cpu torchvision==0.7.0+cpu -f https://download.pytorch.org/whl/torch_stable.html libtorch1.6.0（GPU）：选择使用release版本即可（据说debug有问题） https://download.pytorch.org/libtorch/cu101/libtorch-win-shared-with-deps-1.6.0%2Bcu101.zip libtorch1.6.0（CPU）：选择使用release版本即可（据说debug有问题） https://download.pytorch.org/libtorch/cpu/libtorch-win-shared-with-deps-1.6.0%2Bcpu.zip 2.2 使用cmakelist的搭建工程 cmake_minimum_required(VERSION 3.12 FATAL_ERROR) project(torch_gpu_test) # add CMAKE_PREFIX_PATH list(APPEND CMAKE_PREFIX_PATH "D:/software/opencv/opencv/build/x64/vc15/lib") list(APPEND CMAKE_PREFIX_PATH "D:/software/libtorch_gpu") list(APPEND CUDA_TOOLKIT_ROOT_DIR" />
    <meta property="og:url" content="http://localhost:4000/Libtorch%E7%9A%84GPU%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95" />
    <meta property="og:image" content="http://localhost:4000/assets/images/torch_err.jpeg" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2020-11-27T04:21:00+08:00" />
    <meta property="article:modified_time" content="2020-11-27T04:21:00+08:00" />
    <meta property="article:tag" content="Pytorch" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Libtorch的GPU使用问题记录" />
    <meta name="twitter:description" content="这里得吹逼下自己领导，10min解决了困扰我2天的问题（好吧，也许是我太蠢）。 一. 问题描述 由于项目需要使用libtorch（pytorch的C++版本）的GPU版本，但是发现无法使用GPU，因此将问题和解决过程记录下来，方便日后观看和反思。 二. 解决问题的过程 2.1 使用的torch版本 这里需要说下pytorch和libtorch的版本一定要一致，且和cuda的版本一致。这里都是通过pytorch官网上进行安装即可。 pytorch1.6.0（GPU）：使用pip安装 # CUDA 10.1 pip install torch==1.6.0+cu101 torchvision==0.7.0+cu101 -f https://download.pytorch.org/whl/torch_stable.html pytorch1.6.0（CPU）：使用pip安装 # CPU only pip install torch==1.6.0+cpu torchvision==0.7.0+cpu -f https://download.pytorch.org/whl/torch_stable.html libtorch1.6.0（GPU）：选择使用release版本即可（据说debug有问题） https://download.pytorch.org/libtorch/cu101/libtorch-win-shared-with-deps-1.6.0%2Bcu101.zip libtorch1.6.0（CPU）：选择使用release版本即可（据说debug有问题） https://download.pytorch.org/libtorch/cpu/libtorch-win-shared-with-deps-1.6.0%2Bcpu.zip 2.2 使用cmakelist的搭建工程 cmake_minimum_required(VERSION 3.12 FATAL_ERROR) project(torch_gpu_test) # add CMAKE_PREFIX_PATH list(APPEND CMAKE_PREFIX_PATH "D:/software/opencv/opencv/build/x64/vc15/lib") list(APPEND CMAKE_PREFIX_PATH "D:/software/libtorch_gpu") list(APPEND CUDA_TOOLKIT_ROOT_DIR" />
    <meta name="twitter:url" content="http://localhost:4000/" />
    <meta name="twitter:image" content="http://localhost:4000/assets/images/torch_err.jpeg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="李小肥的YY" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Pytorch" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "李小肥的YY",
        "logo": "http://localhost:4000/"
    },
    "url": "http://localhost:4000/Libtorch%E7%9A%84GPU%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95",
    "image": {
        "@type": "ImageObject",
        "url": "http://localhost:4000/assets/images/torch_err.jpeg",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:4000/Libtorch%E7%9A%84GPU%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95"
    },
    "description": "这里得吹逼下自己领导，10min解决了困扰我2天的问题（好吧，也许是我太蠢）。 一. 问题描述 由于项目需要使用libtorch（pytorch的C++版本）的GPU版本，但是发现无法使用GPU，因此将问题和解决过程记录下来，方便日后观看和反思。 二. 解决问题的过程 2.1 使用的torch版本 这里需要说下pytorch和libtorch的版本一定要一致，且和cuda的版本一致。这里都是通过pytorch官网上进行安装即可。 pytorch1.6.0（GPU）：使用pip安装 # CUDA 10.1 pip install torch==1.6.0+cu101 torchvision==0.7.0+cu101 -f https://download.pytorch.org/whl/torch_stable.html pytorch1.6.0（CPU）：使用pip安装 # CPU only pip install torch==1.6.0+cpu torchvision==0.7.0+cpu -f https://download.pytorch.org/whl/torch_stable.html libtorch1.6.0（GPU）：选择使用release版本即可（据说debug有问题） https://download.pytorch.org/libtorch/cu101/libtorch-win-shared-with-deps-1.6.0%2Bcu101.zip libtorch1.6.0（CPU）：选择使用release版本即可（据说debug有问题） https://download.pytorch.org/libtorch/cpu/libtorch-win-shared-with-deps-1.6.0%2Bcpu.zip 2.2 使用cmakelist的搭建工程 cmake_minimum_required(VERSION 3.12 FATAL_ERROR) project(torch_gpu_test) # add CMAKE_PREFIX_PATH list(APPEND CMAKE_PREFIX_PATH "D:/software/opencv/opencv/build/x64/vc15/lib") list(APPEND CMAKE_PREFIX_PATH "D:/software/libtorch_gpu") list(APPEND CUDA_TOOLKIT_ROOT_DIR"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Libtorch的GPU使用问题记录" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo">李小肥的YY</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">首页</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/machinelearning/">机器学习</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/deeplearning/">深度学习</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">关于</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
                <a class="social-link social-link-github" href="https://github.com/yy2lyx" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path d="M16 .395c-8.836 0-16 7.163-16 16 0 7.069 4.585 13.067 10.942 15.182.8.148 1.094-.347 1.094-.77 0-.381-.015-1.642-.022-2.979-4.452.968-5.391-1.888-5.391-1.888-.728-1.849-1.776-2.341-1.776-2.341-1.452-.993.11-.973.11-.973 1.606.113 2.452 1.649 2.452 1.649 1.427 2.446 3.743 1.739 4.656 1.33.143-1.034.558-1.74 1.016-2.14-3.554-.404-7.29-1.777-7.29-7.907 0-1.747.625-3.174 1.649-4.295-.166-.403-.714-2.03.155-4.234 0 0 1.344-.43 4.401 1.64a15.353 15.353 0 0 1 4.005-.539c1.359.006 2.729.184 4.008.539 3.054-2.07 4.395-1.64 4.395-1.64.871 2.204.323 3.831.157 4.234 1.026 1.12 1.647 2.548 1.647 4.295 0 6.145-3.743 7.498-7.306 7.895.574.497 1.085 1.47 1.085 2.963 0 2.141-.019 3.864-.019 4.391 0 .426.288.925 1.099.768C27.421 29.457 32 23.462 32 16.395c0-8.837-7.164-16-16-16z"/></svg>
</a>
            
            
                <a class="social-link social-link-mail" href="mailto:yeyansiwangtt@gmail.com" target="_blank" rel="noopener"><!-- <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path d="M26.666 0H5.334C2.4 0 0 2.4 0 5.333v21.333C0 29.6 2.4 32 5.334 32h21.332C29.602 32 32 29.6 32 26.666V5.333C32 2.399 29.602 0 26.666 0zM8 8h16c.286 0 .563.061.817.177L16 18.463 7.183 8.176c.254-.116.531-.177.817-.177zM6 22V10c0-.042.002-.084.004-.125l5.864 6.842-5.8 5.8A1.983 1.983 0 0 1 5.999 22zm18 2H8c-.177 0-.35-.024-.517-.069l5.691-5.691L16 21.537l2.826-3.297 5.691 5.691c-.167.045-.34.069-.517.069zm2-2c0 .177-.024.35-.069.517l-5.8-5.8 5.864-6.842c.003.041.004.083.004.125v12z"/></svg> -->
<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 35 35"><path d="M26.667 0H5.334C2.4 0 0 2.4 0 5.334v21.332C0 29.602 2.4 32 5.334 32h21.333C29.601 32 32 29.602 32 26.666V5.334C32 2.4 29.601 0 26.667 0zm0 4c.25 0 .486.073.688.198L16 13.586 4.645 4.199c.202-.125.439-.198.689-.198h21.333zM5.334 28a1.32 1.32 0 0 1-.178-.013l7.051-9.78-.914-.914L4 24.586V5.488L16 20 28 5.488v19.098l-7.293-7.293-.914.914 7.051 9.78a1.294 1.294 0 0 1-.177.013H5.334z"/></svg>
<!-- <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path d="M26.667 0H5.334C2.4 0 0 2.4 0 5.334v21.332C0 29.602 2.4 32 5.334 32h21.333C29.601 32 32 29.602 32 26.666V5.334C32 2.4 29.601 0 26.667 0zM5.707 27.707l-2.414-2.414 8-8 .914.914-6.5 9.5zm-.914-21.5l.914-.914L16 13.586l10.293-8.293.914.914L16 19.414 4.793 6.207zm21.5 21.5l-6.5-9.5.914-.914 8 8-2.414 2.414z"/></svg> -->
<!-- <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path d="M16 0C7.163 0 0 7.163 0 16s7.163 16 16 16 16-7.163 16-16S24.837 0 16 0zM8 8h16c.286 0 .563.061.817.177L16 18.463 7.183 8.176c.254-.116.531-.177.817-.177zM6 22V10c0-.042.002-.084.004-.125l5.864 6.842-5.8 5.8A1.983 1.983 0 0 1 5.999 22zm18 2H8c-.177 0-.35-.024-.517-.069l5.691-5.691L16 21.537l2.826-3.297 5.691 5.691c-.167.045-.34.069-.517.069zm2-2c0 .177-.024.35-.069.517l-5.8-5.8 5.865-6.842c.003.041.004.083.004.125v12z"/></svg> -->
</a>
            
            
                <a class="social-link social-link-zhihu" href="https://www.zhihu.com/people/xie-yan-44-84-33" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 35 35"><image xlink:href="data:;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAIAAABuYg/PAAACp0lEQVRIDb3BPWqUbRiG4fOcNOltrIMYLLS4scpsQFyAK3ATCnaCbsIFuAKx96eQu7IJCWJpY226XB888MKEeSbfCDHHIbdIbpHs8PDhw+/fv3OjZCbDarXiRsmWJMDLly/fvHnDjZKrDg8PLy4uAJWbJlclYVD5P+v1+tOnT+xBBeSqJOxBBaqqu9mDCshVSdiDClRVd7MHFZANSRhUhiQMKluqqrsBlZkkDCogG5IA5+fn9+/fZ0jCoLKlqrobUJlJwqACsjg9PT0+PgZUFkkYVLZUVXcDKjNJGFRAFkkAlQ1JGFS2VFV3AyozSRhUQK6VhEFlS1V1N6Ayk4RBBeRaSRhUtlRVdwMqM0kYVECulQT48uXLer1mS1V1N6Ayk4RBBeRaSYB37949f/6cLVXV3YDKTBIGFZDFvXv3zs/P2c/p6emDBw+qqrsBlZkkDCogiyT8DbWquhtQmUnCoAKySMLfUKuquwGVmSQMKiDXSgKozFRVdwMqM0kYVEB2e/z48bdv3wCVmarqbkBlJgmDCshuFxcXh4eHgMpMVXU3oDKThEEFZLckLH7+/Hl0dMRVVdXdgMpMEgYVkN2SsOHVq1evX79mQ1V1N6Ayk4RBBWSH379/37lzB1CTMBwcHFxeXrKoqu4GVGaSMKiA7JCEQQWSMKgsqqq7AZWZJAwqIDNJGFQWSRhUhqrqbiDJarVikeTy8hJYrVYMKiAzSRhUFs+ePXv//j1wdnZ2fHwMVFV3Mzx58uTjx49AEraogGxJwvD06dMPHz6w4cePH0dHR4AKVFV3swcVkKuSsFDZkuTFixdv375lQxIWJycnX79+ZUY2JGGhsre7d+/++vULUNlNFklYqPyl9Xr9+fNnriXDo0ePVqvV2dnZnz9/+GfkFskt+g8PKj40CkCOhAAAAABJRU5ErkJggg=="/></svg></a>
            
        </div>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-pytorch post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="27 November 2020">27 November 2020</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/pytorch/'>PYTORCH</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Libtorch的GPU使用问题记录</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/images/torch_err.jpeg)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <blockquote>
  <p>这里得吹逼下自己领导，10min解决了困扰我2天的问题（好吧，也许是我太蠢）。</p>
</blockquote>

<h3 id="一-问题描述">一. 问题描述</h3>

<p>由于项目需要使用libtorch（pytorch的C++版本）的GPU版本，但是发现无法使用GPU，因此将问题和解决过程记录下来，方便日后观看和反思。</p>

<h3 id="二-解决问题的过程">二. 解决问题的过程</h3>

<h4 id="21-使用的torch版本">2.1 使用的torch版本</h4>

<p>这里需要说下pytorch和libtorch的版本一定要一致，且和cuda的版本一致。这里都是通过pytorch官网上进行安装即可。</p>

<ul>
  <li>
    <p>pytorch1.6.0（GPU）：使用pip安装</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># CUDA 10.1
pip install torch==1.6.0+cu101 torchvision==0.7.0+cu101 -f https://download.pytorch.org/whl/torch_stable.html
</code></pre></div>    </div>
  </li>
  <li>
    <p>pytorch1.6.0（CPU）：使用pip安装</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># CPU only
pip install torch==1.6.0+cpu torchvision==0.7.0+cpu -f https://download.pytorch.org/whl/torch_stable.html
</code></pre></div>    </div>
  </li>
  <li>
    <p>libtorch1.6.0（GPU）：选择使用release版本即可（据说debug有问题）</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://download.pytorch.org/libtorch/cu101/libtorch-win-shared-with-deps-1.6.0%2Bcu101.zip
</code></pre></div>    </div>
  </li>
  <li>
    <p>libtorch1.6.0（CPU）：选择使用release版本即可（据说debug有问题）</p>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://download.pytorch.org/libtorch/cpu/libtorch-win-shared-with-deps-1.6.0%2Bcpu.zip
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="22-使用cmakelist的搭建工程">2.2 使用cmakelist的搭建工程</h4>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cmake_minimum_required</span><span class="p">(</span>VERSION 3.12 FATAL_ERROR<span class="p">)</span>
<span class="nb">project</span><span class="p">(</span>torch_gpu_test<span class="p">)</span>

<span class="c1"># add CMAKE_PREFIX_PATH</span>
<span class="nb">list</span><span class="p">(</span>APPEND CMAKE_PREFIX_PATH <span class="s2">"D:/software/opencv/opencv/build/x64/vc15/lib"</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span>APPEND CMAKE_PREFIX_PATH <span class="s2">"D:/software/libtorch_gpu"</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span>APPEND CUDA_TOOLKIT_ROOT_DIR <span class="s2">"D:/software/cuda/development"</span><span class="p">)</span>


<span class="nb">find_package</span><span class="p">(</span>Torch REQUIRED<span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span>OpenCV REQUIRED<span class="p">)</span>

<span class="nb">if</span><span class="p">(</span>NOT Torch_FOUND<span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>FATAL_ERROR <span class="s2">"Pytorch Not Found!"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">(</span>NOT Torch_FOUND<span class="p">)</span>

<span class="nb">message</span><span class="p">(</span>STATUS <span class="s2">"Pytorch status:"</span><span class="p">)</span>
<span class="nb">message</span><span class="p">(</span>STATUS <span class="s2">"    libraries: </span><span class="si">${</span><span class="nv">TORCH_LIBRARIES</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">message</span><span class="p">(</span>STATUS <span class="s2">"Find Torch VERSION: </span><span class="si">${</span><span class="nv">Torch_VERSION</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="nb">message</span><span class="p">(</span>STATUS <span class="s2">"OpenCV library status:"</span><span class="p">)</span>
<span class="nb">message</span><span class="p">(</span>STATUS <span class="s2">"    version: </span><span class="si">${</span><span class="nv">OpenCV_VERSION</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">message</span><span class="p">(</span>STATUS <span class="s2">"    libraries: </span><span class="si">${</span><span class="nv">OpenCV_LIBS</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">message</span><span class="p">(</span>STATUS <span class="s2">"    include path: </span><span class="si">${</span><span class="nv">OpenCV_INCLUDE_DIRS</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>


<span class="nb">add_executable</span><span class="p">(</span>torch_gpu_test torch_gpu_test.cpp<span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span>torch_gpu_test <span class="si">${</span><span class="nv">TORCH_LIBRARIES</span><span class="si">}</span> <span class="si">${</span><span class="nv">OpenCV_LIBS</span><span class="si">}</span><span class="p">)</span>
<span class="nb">set_property</span><span class="p">(</span>TARGET torch_gpu_test PROPERTY CXX_STANDARD 11<span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>这里利用vs2019生成项目之后，编写以下代码进行测试：</li>
</ul>

<pre><code class="language-C++">#include &lt;torch/torch.h&gt;
#include &lt;torch/script.h&gt;

using namespace torch;

int main()
{
    torch::DeviceType device_type = at::kCPU;
    if (torch::cuda::is_available()) {
        cout &lt;&lt; "cuda!" &lt;&lt; endl;
        torch::DeviceType device_type = at::kCUDA;
    }
    else
    {
        cout &lt;&lt; "cpu" &lt;&lt; endl;
    }
    
}
</code></pre>

<ul>
  <li>到了这里我开始了我的问题之旅：由于是Release版本，不能debug，只能主观的认为这里应该是cuda的环境没配好导致torch无法使用gpu的，因此一直在找cmake的cuda环境配置问题。</li>
</ul>

<h4 id="23-release-with-debug改变了我的想法">2.3 Release with Debug改变了我的想法</h4>

<blockquote>
  <p>这里得说下本人第一次知道release版本也可以debug！（本人也算一C++小白哈，别计较）</p>
</blockquote>

<p>这里顺带记录下如何使用vs2019的Release with debug的过程：</p>

<ul>
  <li>直接在项目中将<code class="highlighter-rouge">Release</code>版本选择为<code class="highlighter-rouge">RelWithDebInfo</code></li>
</ul>

<p><img src="https://i.loli.net/2021/02/01/FcP7UNy4fqTxkR1.png" alt="" /></p>

<ul>
  <li>禁用代码优化功能：这里是防止出现“变量已被优化掉 因而不可用”这种问题</li>
</ul>

<p><img src="https://i.loli.net/2021/02/01/KSBZQE8f7IkenWD.png" alt="" /></p>

<p>在这里debug的时候发现，<code class="highlighter-rouge">device</code>这个我定义的变量是可以加载cuda的！因此可以推翻我之前想的（cuda环境的问题）。</p>

<h4 id="24-libtorch16gpu版本问题">2.4 libtorch1.6GPU版本问题</h4>

<p>这里就可以肯定是libtorch的GPU问题了。为啥<code class="highlighter-rouge">torch::cuda::is_available()</code>会是<code class="highlighter-rouge">false</code>呢？</p>

<ul>
  <li>网上的思路是：</li>
</ul>

<p>在“属性 –&gt; 链接器 –&gt; 命令行 –&gt; 其他选项”中添加：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  /INCLUDE:?warp_size@cuda@at@@YAHXZ
</code></pre></div></div>

<ul>
  <li>本人实验了下，按照网上的添加会报错，因此以下是本人实验可行的结果：</li>
</ul>

<p>在“链接器 –&gt; 输入 –&gt; 附加依赖项”中进行添加：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>D:\yeyan\software\libtorch_gpu\lib\torch_cuda.lib
D:\yeyan\software\libtorch_gpu\lib\torch_cpu.lib
-INCLUDE:?warp_size@cuda@at@@YAHXZ
</code></pre></div></div>

<blockquote>
  <p>这里很奇怪，cmakelist明明已经配置好了libtorch的gpu，但是这里却没有<code class="highlighter-rouge">torch_cuda.lib</code></p>
</blockquote>

<p>至此，问题解决了！</p>


                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/blog-cover.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; 李小肥的YY &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/pytorch/">Pytorch</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/GCN%E5%9C%A8%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8">GCN在多标签分类中的应用</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/windows-%E4%B8%8B%E6%90%AD%E5%BB%BAlibtorch%E5%92%8Cpaddle%E7%9A%84C++%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">windows下搭建libtorch和paddle的C++环境搭建</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/pytorch%E4%BD%BF%E7%94%A8YOLOv5%E8%AE%AD%E7%BB%83%E6%95%B0%E6%8D%AE">pytorch使用YOLOv5训练数据</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/pytorch/">
                                
                                    查看相关的 4 篇文章  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/GCN%E5%9C%A8%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8">
                <div class="post-card-image" style="background-image: url(/assets/images/m_phone.jpeg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/GCN%E5%9C%A8%E5%A4%9A%E6%A0%87%E7%AD%BE%E5%88%86%E7%B1%BB%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Pytorch</span>
                            
                        
                            
                               <span class="post-card-tags">Gcn</span>
                            
                        
                            
                               <span class="post-card-tags">图算法</span>
                            
                        
                            
                                <span class="post-card-tags">Deeplearning</span>
                            
                        
                    

                    <h2 class="post-card-title">GCN在多标签分类中的应用</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="http://localhost:4000/">
            
                <img src="/assets/images/yy.jpg" alt="李小肥的YY icon" />
            
            <span>李小肥的YY</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Libtorch的GPU使用问题记录</div>
    <!-- <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Libtorch%E7%9A%84GPU%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95&amp;url=www.lixiaofei2yy.websiteLibtorch%E7%9A%84GPU%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=www.lixiaofei2yy.websiteLibtorch%E7%9A%84GPU%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div> -->
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="http://localhost:4000/">李小肥的YY</a> &copy; 2021</section>
                <!-- <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav> -->
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69281367-1', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
